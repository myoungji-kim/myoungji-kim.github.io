---
title: "ê¹¨ë—í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œ"
excerpt: "Unit Test. í…ŒìŠ¤íŠ¸ ì½”ë“œ ê¸°ë³¸ê¸° ë‹¤ì§€ê¸°"

categories:
  - Repost
# tags:
#   - [tag1, tag2]

permalink: /unit-test/basic/

toc: true
toc_sticky: true

date: 2022-09-25
last_modified_at: 2022-09-25
---

### ğŸ§© <b>í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ì¤‘ìš”ì„±</b>
#### <span style="background-color:#fff5b1;"><b>í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì™œ ì¤‘ìš”í• ê¹Œ</b></span>
- í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì‹¤ìˆ˜ë¥¼ ë°”ë¡œì¡ì•„ ì¤€ë‹¤
- í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë°˜ë“œì‹œ ì¡´ì¬í•´ì•¼ í•˜ë©°, ì‹¤ì œ ì½”ë“œ ëª»ì§€ ì•Šê²Œ ì¤‘ìš”í•˜ë‹¤
- <b>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ëŠ” ë³€ê²½ì´ ì‰½ê²Œ í•´ì¤€ë‹¤.</b> ì½”ë“œì— ìœ ì—°ì„±, ìœ ì§€ë³´ìˆ˜ì„±, ì¬ì‚¬ìš©ì„±ì„ ì œê³µí•˜ëŠ” ë²„íŒ€ëª©ì´ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë‹¤. í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ê°€ ìˆìœ¼ë©´ ë³€ê²½ì´ ë‘ë µì§€ ì•Šìœ¼ë©°, í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ê°€ ì—†ë‹¤ë©´ ëª¨ë“  ë³€ê²½ì´ ì ì •ì ì¸ ë²„ê·¸ë‹¤. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ê°€ ë†’ì„ìˆ˜ë¡ ë²„ê·¸ì— ëŒ€í•œ ê³µí¬ê°€ ì¤„ì–´ë“ ë‹¤.
- ì§€ì €ë¶„í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì•ˆí•˜ë‹ˆë§Œ ëª»í•˜ë‹¤.

<br>

#### <span style="background-color:#fff5b1;"><b>\<Effective Unit Test> í…ŒìŠ¤íŠ¸ì˜ ì¤‘ìš”ì„±</b></span>
- í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì‚¬ìš©ì— ì í•©í•œ ì„¤ê³„ë¥¼ ëŒì–´ë‚´ì¤€ë‹¤.
- í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì„œ ì–»ê²Œ ë˜ëŠ” ê°€ì¥ í° ìˆ˜í™•ì€ í…ŒìŠ¤íŠ¸ ìì²´ê°€ ì•„ë‹ˆë‹¤. ì‘ì„± ê³¼ì •ì—ì„œ ì–»ëŠ” <u>ê¹¨ë‹¬ìŒ</u>ì´ë‹¤.

<br>

#### <span style="background-color:#fff5b1;"><b>í…ŒìŠ¤íŠ¸ëŠ” ìë™í™”ë˜ì–´ì•¼ í•œë‹¤</b></span>
![í…ŒìŠ¤íŠ¸](https://martinfowler.com/articles/practical-test-pyramid/buildPipeline.png)

- ê³„ì†í•´ì„œ ì¦ê°€í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ êµ¬ì¶•, í…ŒìŠ¤íŠ¸ ë° ë°°í¬í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•  ê²ƒì´ë‹¤.
- ë¹Œë“œì—ì„œ í…ŒìŠ¤íŠ¸, ë°°í¬ ë° ì¸í”„ë¼ì— ì´ë¥´ê¸°ê¹Œì§€ ëª¨ë“  ê²ƒì„ ìë™í™”í•˜ëŠ” ê²ƒì´ ì•ìœ¼ë¡œ ë‚˜ì•„ê°ˆ ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë°©í–¥ì´ë‹¤.

---

### ğŸ§© <b>í…ŒìŠ¤íŠ¸ì˜ ì¢…ë¥˜</b>
#### <span style="background-color:#fff5b1;"><b>Test Pyramid</b></span>

> êµ¬ê¸€ì˜ ì œì•ˆ : 70% unit tests, 20% integration test, 10% end-to-end tests

- Unit Test : í”„ë¡œê·¸ë¨ ë‚´ë¶€ì˜ ê°œë³„ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•œë‹¤. ë°°í¬í•˜ê¸° ì „ì— ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ ë§ì´ ì‚¬ìš©í•œë‹¤.
- Integration Test : í”„ë¡œê·¸ë¨ ë‚´ë¶€ì˜ ê°œë³„ ì»´í¬ë„ŒíŠ¸ë“¤ì„ í•©ì³ì„œ ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•œë‹¤. Unit TestëŠ” ê° ì»´í¬ë„ŒíŠ¸ë¥¼ ê³ ë¦½ì‹œì¼œ í…ŒìŠ¤íŠ¸í•˜ê¸° ë•Œë¬¸ì— ì»´í¬ë„ŒíŠ¸ì˜ interactionì„ í™•ì¸í•˜ëŠ” Integration Testê°€ í•„ìš”í•˜ë‹¤.
- E2E Test : End to End Test. ì‹¤ì œ ìœ ì €ì˜ ì‹œë‚˜ë¦¬ì˜¤ëŒ€ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì„œë²„ì˜ Endpointë¥¼ í˜¸ì¶œí•´ í…ŒìŠ¤íŠ¸í•œë‹¤.

---

### ğŸ§© <b>ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬</b>

- Junit, PHPUnit : for unit test
- Mockito : for mocking dependencies
- Wiremock : for stubbing out external services
- Pact : for writing CDC tests
- Selenium : for writing UI-driven end-to-end tests
- REST-assured : for writing REST API-driven end-to-end tests

---

### ğŸ§© <b>Unit Test ì‘ì„±í•˜ê¸°</b>

#### <span style="background-color:#fff5b1;"><b>Test Double</b></span>

> í…ŒìŠ¤íŠ¸ì—ì„œ ì›ë³¸ ê°ì²´ë¥¼ ëŒ€ì‹ í•˜ëŠ” ê°ì²´

![Test Double](https://martinfowler.com/articles/practical-test-pyramid/unitTest.png)

- <b>Stub</b>
  - ì›ë˜ëŠ” êµ¬í˜„ì„ ìµœëŒ€í•œ ë‹¨ìˆœí•œ ê²ƒìœ¼ë¡œ ëŒ€ì²´í•œë‹¤
  - í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í”„ë¡œê·¸ë˜ë°ëœ í•­ëª©ì—ë§Œ ì‘ë‹µí•œë‹¤
  
- <b>Spy</b>
  - Stubì˜ ì—­í• ì„ í•˜ë©´ì„œ í˜¸ì¶œì— ëŒ€í•œ ì •ë³´ë¥¼ ê¸°ë¡í•œë‹¤
  - ì´ë©”ì¼ ì„œë¹„ìŠ¤ì—ì„œ ë©”ì‹œì§€ê°€ ëª‡ ë²ˆ ì „ì†¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ë•Œ

- <b>Mock</b>
  - í–‰ìœ„ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ ê°€ì§œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•
  - í˜¸ì¶œì— ëŒ€í•œ ë™ì‘ì„ í”„ë¡œê·¸ë˜ë°í•  ìˆ˜ ìˆë‹¤.
  - Stubì€ ìƒíƒœë¥¼ ê²€ì¦í•˜ê³  Mockì€ í–‰ìœ„ë¥¼ ê²€ì¦í•œë‹¤.

<br>

#### <span style="background-color:#fff5b1;"><b>given-when-then</b></span>

``` java
public void testGetPageHierarchyAsXml() throws Exception {
  givenPages("PageOne", "PageOne.ChildOne", "PageTwo");

  whenRequestIsIssued("root", "type:pages");

  thenResponseShouldBeXML();
}

public void testGetPageHierarchyHasRightTags() throws Exception {
  givenPages("PageOne", "PageOne.ChildOne", "PageTwo");

  whenRequestIsIssued("root", "type:pages");

  thenResponseShouldContain(
    "<name>PageOne</name>", "<name>PageTwo</name>", "<name>ChildOne</name>"
  );
}
```

- given : í…ŒìŠ¤íŠ¸ì— ëŒ€í•œ pre-condition
- when : í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ ë™ì‘ í˜¸ì¶œ
- then : í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸

<br>

#### <span style="background-color:#fff5b1;"><b>Spring Boot Application ì˜ˆì œ</b></span>
![ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ë‚´ë¶€ êµ¬ì¡°](https://martinfowler.com/articles/practical-test-pyramid/testArchitecture.png)

<br>

#### <span style="background-color:#fff5b1;"><b> ExampleController - main ì½”ë“œ</b></span>
``` java
@RestController
public class ExampleController {
  private final PersonRepository personRepo;

  @Autowired
  public ExampleController(final PersonRepository personRepo) {
    this.personRepo = personRepo;
  }

  @GetMapping("/hello/{lastName}")
  public String hello(@PathVariable final String lastName) {
    Optional<Person> foundPerson = personRepo.findByLastName(lastName);

    return foundPerson
          .map(person -> String.format("Hello %s %s!",
                  person.getFirstName(),
                  person.getLastName()))
          .orElse("Cannot hello to unknown");
  }
}
```

<br>

#### <span style="background-color:#fff5b1;"><b>ExampleController - Unit Test</b></span>
``` java
public class ExampleControllerTest {

  // í…ŒìŠ¤íŠ¸ ëŒ€ìƒ
  private ExampleController subject;

  @Mock
  private PersonRepository personRepo;

  @Before
  public void setUp() throws Exception {
    initMocks(this);
    subject = new ExampleController(personRepo);
  }

  @Test
  public void shouldReturnFullNameOfAPerson() throws Exception {
    // given
    Person peter = new Person("Peter", "Pan");
    given(psersonRepo.findByLastName("Pan"))
        .willReturn(Optional.of(peter));

    // when
    String greeting = subject.hello("Pan");

    // then
    assertThat(greeting, is("Hello Peter Pan!"));
  }

  @Test
  public void shouldTellIfPersonIsUnknown() throws Exception {
    // given
    given(psersonRepo.findByLastName(anyString()))
        .willReturn(Optional.empty());

    // when
    String greeting = subject.hello("Pan");

    // then
    assertThat(greeting, is("Cannot hello to unknown"));
  }
}
```

- PersonRepository mock ì‚¬ìš©
- given-when-then êµ¬ì¡°
- repositoryì—ì„œ ê°’ì„ ì½ì–´ì™”ì„ ë•Œì™€ ì½ì–´ì˜¤ì§€ ëª»í–ˆì„ ë•Œ 2ê°€ì§€ ê²½ìš°ë¥¼ í…ŒìŠ¤íŠ¸

<br>

#### <span style="background-color:#fff5b1;"><b>Integration Test (Database)</b></span>
``` java
@RunWith(SpringRunner.class)
@DataJpaTest
public class PersonRepositoryIntegrationTest {
  @Autowired
  private PersonRepository subject;

  @After
  public void tearDown() throws Exception {
    subject.deleteAll();
  }

  @Test
  public void shouldSaveAndFetchPerson() throws Exception {
    // given
    Person peter = new Person("Peter", "Pan");
    subject.save(peter);

    // when
    Optional<Person> maybePeter = subject.findByLastName("Pan");

    // then
    assertThat(maybePeter, is(Optional.of(peter)));
  }
}
```

- PersonRepositoryì´ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ë  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
- in-memory DBì¸ h2ë¡œ í…ŒìŠ¤íŠ¸
- findByLastNameê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
- (Repository â†” database(h2))

<br>

#### <span style="background-color:#fff5b1;"><b>Integration Test (Service)</b></span>
``` java
@RunWith(SpringRunner.class)
@SpringBootTest
public class WeatherClientIntegrationTest {

  @Autowired
  private WeatherClient subject;

  @Rule
  public WireMockRule wireMockRule = new WireMockRule(8089); // mock ì„œë²„ë¥¼ ë„ìš´ë‹¤

  @Test
  public void shouldCallWeatherService() throws Exception {{
    // given: mock ì„œë²„ì— ì‘ë‹µì„ ì„¤ì •í•œë‹¤
    wireMockRule.stubFor(get(urlPathEqualTo("/some-test-api-key/53.5511, 9.9937"))
              .willReturn(aResponse()
                      .withBody(FileLoader.read("classpath:weatherApiResponse.json"))
                      .withHeader(CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
                      .withSatus(200)));

    // when: weatherClientê°€ mock ì„œë²„ë¡œë¶€í„° ì‘ë‹µì„ ë°›ëŠ”ë‹¤
    Optional<WeatherResponse> weatherResponse = subject.fetchWeather();

    // then: ë°›ì•„ì˜¨ ì‘ë‹µì´ ê¸°ëŒ€ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ì§€ í™•ì¸í•œë‹¤
    Optional<WeatherResponse> expectResponse = Optional.of(new WeatherResponse("Rain"));
    assertThat(weatherResponse, is(expectedResponse));
  }}
}
```
- WireMockì„ ì´ìš©í•´ mock ì„œë²„ë¥¼ ë„ìš´ë‹¤
- clientê°€ ì‹¤ì œ ì„œë²„ê°€ ì•„ë‹Œ mock ì„œë²„ë¡œ ìš”ì²­í•˜ê²Œ í•´ì„œ clientì˜ ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•œë‹¤
- (Client â†” Weather API (mock server))


---

### ğŸ§© <b>First ì›ì¹™</b>
#### <span style="background-color:#fff5b1;"><b>Fast : ë¹ ë¥´ê²Œ</b></span>
- í…ŒìŠ¤íŠ¸ëŠ” ìì£¼ ëŒë ¤ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë¹¨ë¦¬ ëŒì•„ì•¼ í•œë‹¤.

#### <span style="background-color:#fff5b1;"><b>Independent : ë…ë¦½ì ìœ¼ë¡œ</b></span>
- ê° í…ŒìŠ¤íŠ¸ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ì‘ì„±í•œë‹¤.
- ì„œë¡œì—ê²Œ ì˜ì¡´í•˜ë©´ ì‹¤íŒ¨í•œ ì›ì¸ì„ ì°¾ê¸° ì–´ë ¤ì›Œì§„ë‹¤.
- (ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ë•Œë¬¸ì¸ì§€, ì½”ë“œ ì˜¤ë¥˜ì¸ì§€)

#### <span style="background-color:#fff5b1;"><b>Repeatable : ë°˜ë³µ ê°€ëŠ¥í•˜ê²Œ</b></span>
- í…ŒìŠ¤íŠ¸ëŠ” ì–´ë–¤ í™˜ê²½ì—ì„œë„ ë°˜ë³µ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
- ì‹¤ì œ í™˜ê²½, QA í™˜ê²½ ë“± ëª¨ë“  í™˜ê²½ì—ì„œ ëŒì•„ì•¼ í•œë‹¤.

#### <span style="background-color:#fff5b1;"><b>Self-Validating : ìê°€ ê²€ì¦í•˜ëŠ”</b></span>
- í…ŒìŠ¤íŠ¸ëŠ” bool ê°’ìœ¼ë¡œ ê²°ê³¼ë¥¼ ë‚´ì•¼ í•œë‹¤.

#### <span style="background-color:#fff5b1;"><b>Timely : ì ì‹œì—</b></span>
- í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” ì‹¤ì œ ì½”ë“œë¥¼ êµ¬í˜„í•˜ê¸° ì§ì „ì— êµ¬í˜„í•œë‹¤.

---

### ğŸ§© <b>Junit5 Samples</b>
``` java
package com.example.projects;

import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.CsvSource;

class CalculaterTests {

  @Test
  @DisplayName("1 + 1 = 2")
  void addsTwoNumbers() {
    Calculator calculator = new Calculator();
    assertEquals(2, calculator.add(1, 1), "1 + 1 should equal 2");
  }

  @ParameterizedTest(name = "{0} + {1} = {2}")
  @CsvSource({
                "0,    1,   1",
                "1,    2,   3",
                "49,  51, 100",
                "1,  100, 101"
  })

  void add(int first, int second, int expectedResult) {
    Calculator calculator = new Calculator();
    assertEquals(expectedResult, calculator.add(first, second),
                  () -> first + " + " + second + " should equal " + expectedResult);
  }
}
```
- `@DisplayName`ì€ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë‚˜ ë©”ì„œë“œì— ë³´ì—¬ì§ˆ ì´ë¦„ì„ ì…ë ¥í•˜ëŠ” ê²ƒ. í…ŒìŠ¤íŠ¸ì˜ ëª©ì ì„ ëª…í™•í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆìŒ
- `@ParameterizedTest`ëŠ” í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œë¡œ ì—¬ëŸ¬ê°€ì§€ parameterë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤. `@CsvSource`ì˜ ê°’ì„ parameterë¡œ ë„˜ê¸´ë‹¤.
- Junit5ê°€ í…ŒìŠ¤íŠ¸ì— ê´€í•œ ìœ ìš©í•œ ê¸°ëŠ¥ì„ ë§ê¸° ê°€ì§€ê³  ìˆì–´ì„œ ì‹¤ë¬´ì—ì„œ ë§ì´ í™œìš©ëœë‹¤.


---

### ğŸ§© <b>ì°¸ê³ ìë£Œ</b>

- [ì‹¤ìš© í…ŒìŠ¤íŠ¸ íŒŒë¼ë¯¸ë“œ](https://martinfowler.com/articles/practical-test-pyramid.html)